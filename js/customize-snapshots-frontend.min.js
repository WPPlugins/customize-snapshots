var CustomizeSnapshotsFrontend=function(a){"use strict";var b={data:{uuid:"",home_url:{scheme:"",host:"",path:""},l10n:{restoreSessionPrompt:""}}};return b.init=function(a){_.extend(b.data,a),b.hasSessionStorage="undefined"!=typeof sessionStorage,b.keepSessionAlive(),b.rememberSessionSnapshot(),b.injectSnapshotIntoLinks(),b.handleExitSnapshotSessionLink(),b.injectSnapshotIntoAjaxRequests(),b.injectSnapshotIntoForms()},b.keepSessionAlive=function(){var c,d,e;b.hasSessionStorage&&(c=sessionStorage.getItem("customize_snapshot_uuid"),c&&!b.data.uuid&&(d=document.createElement("a"),d.href=location.href,d.search.length>1&&(d.search+="&"),d.search+="customize_snapshot_uuid="+encodeURIComponent(sessionStorage.getItem("customize_snapshot_uuid")),a(function(){e=a("#wp-admin-bar-resume-customize-snapshot"),e.length?(e.find("> a").prop("href",d.href),e.show()):confirm(b.data.l10n.restoreSessionPrompt)?location.replace(d.href):sessionStorage.removeItem("customize_snapshot_uuid")})))},b.rememberSessionSnapshot=function(){b.hasSessionStorage&&b.data.uuid&&sessionStorage.setItem("customize_snapshot_uuid",b.data.uuid)},b.injectSnapshotIntoLinks=function(){var c="a, area";b.data.uuid&&a(function(){a(document.body).find(c).each(function(){b.injectSnapshotLinkParam(this)}),"undefined"!=typeof MutationObserver?(b.mutationObserver=new MutationObserver(function(d){_.each(d,function(d){a(d.target).find(c).each(function(){b.injectSnapshotLinkParam(this)})})}),b.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0})):a(document.documentElement).on("click focus mouseover",c,function(){b.injectSnapshotLinkParam(this)})})},b.isMatchingBaseUrl=function(a){return a.hostname===b.data.home_url.host&&0===a.pathname.indexOf(b.data.home_url.path)},b.shouldLinkHaveSnapshotParam=function(c){return!!b.isMatchingBaseUrl(c)&&(!/\/wp-(login|signup)\.php$/.test(c.pathname)&&(!!/\/wp-admin\/admin-ajax\.php$/.test(c.pathname)||!/\/wp-admin(\/|$)/.test(c.pathname)&&!a(c).closest("#wpadminbar").length))},b.doesLinkHaveSnapshotQueryParam=function(a){return/(^|&)customize_snapshot_uuid=/.test(a.search.substr(1))},b.injectSnapshotLinkParam=function(a){!b.doesLinkHaveSnapshotQueryParam(a)&&b.shouldLinkHaveSnapshotParam(a)&&(a.search.length>1&&(a.search+="&"),a.search+="customize_snapshot_uuid="+encodeURIComponent(b.data.uuid))},b.handleExitSnapshotSessionLink=function(){a(function(){b.hasSessionStorage&&a("#wpadminbar").on("click","#wp-admin-bar-exit-customize-snapshot",function(){sessionStorage.removeItem("customize_snapshot_uuid")})})},b.injectSnapshotIntoAjaxRequests=function(){a.ajaxPrefilter(b.prefilterAjax)},b.prefilterAjax=function(a){var c;b.data.uuid&&(c=document.createElement("a"),c.href=a.url,b.isMatchingBaseUrl(c)&&-1===c.search.indexOf("customize_snapshot_uuid="+b.data.uuid)&&(c.search.substr(1).length>0&&(c.search+="&"),c.search+="customize_snapshot_uuid="+b.data.uuid,a.url=c.href))},b.injectSnapshotIntoForms=function(){b.data.uuid&&a(function(){a(document.body).find("form").each(function(){b.injectSnapshotFormInput(this)}),"undefined"!=typeof MutationObserver&&(b.mutationObserver=new MutationObserver(function(c){_.each(c,function(c){a(c.target).find("form").each(function(){b.injectSnapshotFormInput(this)})})}),b.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0}))})},b.injectSnapshotFormInput=function(c){var d;a(c).find("input[name=customize_snapshot_uuid]").length>0||(d=document.createElement("a"),d.href=c.action,b.isMatchingBaseUrl(d)&&a(c).prepend(a("<input>",{type:"hidden",name:"customize_snapshot_uuid",value:b.data.uuid})))},b}(jQuery);