!function(a){"use strict";var b={doingAjax:!1,postMigrationCount:5};b.init=function(){a(function(){b.el=a("#customize-snapshot-migration"),b.bindClick(),b.spinner=a(".spinner.customize-snapshot-spinner"),b.spinner.css("margin","0")})},b.bindClick=function(){b.el.click(function(){b.doingAjax||(b.spinner.css("visibility","visible"),b.doingAjax=!0,b.migrate(b.el.data("nonce"),b.postMigrationCount))})},b.migrate=function(c,d){var e,f={nonce:c,limit:d};e=wp.ajax.post("customize_snapshot_migration",f),e.done(function(e){var f,g=a("div.customize-snapshot-migration"),h=100;e.remaining_posts?(f=e.remaining_posts>d?d:e.remaining_posts,_.delay(b.migrate,h,c,f)):(b.spinner.css("visibility","hidden"),g.removeClass("notice-error").addClass("notice-success").find("p").html(b.el.data("migration-success")),b.doingAjax=!1)}),e.fail(function(){b.spinner.css("visibility","initial"),b.doingAjax=!1,window.console&&window.console.error("Migration ajax failed. Click notice to start it again.")})},b.init()}(jQuery);